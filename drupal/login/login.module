<?php
/*
    $Id: login.module 199 2005-07-05 11:01:55Z sam $
    
    A Drupal module providing a small login block which is hidden if the user
    is already logged in.
    
    Copyright (C) 2005 Sam Deane, Elegant Chaos.

  VERSION:
    1.0
    
  LICENSE:
  
    This program is free software; you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation; either version 2 of the License, or
    (at your option) any later version.
    
    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
    
    You should have received a copy of the GNU General Public License
    along with this program; if not, write to the Free Software
    Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
    
  USAGE:

    Just turn the module on, then turn the block on.
    
  TODO:
    - settings to determine the title of the block
    
  CHANGES:
*/

function login_block($op = 'list', $delta = 0)
{
  global $user;
  
  // The $op parameter determines what piece of information is being requested. 
  if ($op == 'list')
  { 
    // If $op is "list", we just need to return a list of block descriptions. This 
    // is used to provide a list of possible blocks to the administrator. 
    $blocks[0]['info'] = t('Smaller Login'); 
    return $blocks; 
  } 
  
  else
  { 
    // If $op is "view", then we need to generate the block for display purposes. 
    // The $delta parameter tells us which block is being requested. 
    switch ($delta)
    { 
      case 0: 
        if (!$user->uid)
        {
          // The subject is displayed at the top of the block. Note that it should 
          // be passed through t() for translation. 
          $block['subject'] = t('Login'); 
        
          // The content of the block is typically generated by calling a custom 
          // function. 
          $block['content'] = t('<p><a href="/?q=user/login">login</a> or <a href="/?q=user/register">register</a></p>');
        }
                
        break; 
    } 

    return $block; 
  }
}

function login_help($section = "admin/help#login")
{
  switch ($section)
  {
    case 'admin/modules#name':
      return t('login');
      
    case 'admin/modules#description':
      return t('a smaller login block.');
  }
  
  return '';
}

